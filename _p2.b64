
export class PlanningIntelligence {
    analyzeRisks(tasks: Task[]): RiskAnalysis {
        if (tasks.length === 0) return { overallRisk: 'low', riskScore: 0, factors: [], recommendations: ['No tasks to analyze. Create tasks first.'], criticalPath: [], bottlenecks: [] };
        const factors: RiskFactor[] = [];
        const graph = this.buildDependencyGraph(tasks);
        if (tasks.length > 50) factors.push({ id: gid('risk'), category: 'scope', severity: 'high', probability: 0.7, impact: 0.6, riskScore: 0.7*0.6*SW['high'], title: 'Large plan scope', description: `Plan has ${tasks.length} tasks, which increases coordination overhead.`, mitigation: 'Consider breaking the plan into phases of 20-30 tasks each.', affectedTasks: tasks.map(t => t.id) });
        else if (tasks.length > 30) factors.push({ id: gid('risk'), category: 'scope', severity: 'medium', probability: 0.4, impact: 0.4, riskScore: 0.4*0.4*SW['medium'], title: 'Moderate plan scope', description: `Plan has ${tasks.length} tasks. Monitor for scope growth.`, mitigation: 'Review and prune low-priority tasks regularly.', affectedTasks: tasks.map(t => t.id) });
        const p1Tasks = tasks.filter(t => t.priority === TaskPriority.P1);
        const p1Ratio = p1Tasks.length / tasks.length;
        if (p1Ratio > 0.7) factors.push({ id: gid('risk'), category: 'resource', severity: 'high', probability: 0.8, impact: 0.7, riskScore: 0.8*0.7*SW['high'], title: 'Excessive P1 concentration', description: `${Math.round(p1Ratio*100)}% of tasks are P1. When everything is critical, nothing is.`, mitigation: 'Re-prioritize: only truly blocking tasks should be P1.', affectedTasks: p1Tasks.map(t => t.id) });
        else if (p1Ratio > 0.5) factors.push({ id: gid('risk'), category: 'resource', severity: 'medium', probability: 0.5, impact: 0.5, riskScore: 0.5*0.5*SW['medium'], title: 'High P1 concentration', description: `${Math.round(p1Ratio*100)}% of tasks are P1.`, mitigation: 'Review P1 tasks and downgrade those that are not truly blocking.', affectedTasks: p1Tasks.map(t => t.id) });
